#!/usr/bin/python3
import os
import json
import argparse
import requests
from dotenv import load_dotenv

load_dotenv()

API_URL = "https://smartclass.uaa.k12.tr/student/index.php"
HEADERS = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0",
    "X-Requested-With": "XMLHttpRequest",
}
COOKIES = {
    "lang": "english",
    "admin": os.getenv("TOKEN"),
    "campusID": "0",
    "bigbluebutton": "1",
    "eokul": "1",
    "link": "1",
    "userFolder": "student",
    "branchID": "1",
    "seasonID": "sev_2021_2022",
}


def main():
    parser = argparse.ArgumentParser(description="Search students on Smartclass")
    parser.add_argument("name", help="name of the student")
    args = parser.parse_args()

    r = requests.post(
        API_URL,
        params={
            "op": "makeGlobalSearch",
        },
        data={
            "searchFor": "user",  # searches for everyone
            "searchBy": args.name,
        },
        cookies=COOKIES,
        headers=HEADERS,
    )
    users = json.loads(r.content)["results"]
    for i, user in enumerate(users):
        aid = user["aid"]
        name = user["name"]
        email = user["email"]

        print(f"Name: {name}")
        print(f"TC Kimlik No: {aid}")
        print(f"Email: {email}")
        if i != len(users) - 1:
            print()


if __name__ == "__main__":
    main()
